<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keldi-Ketdi Tizimi</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: #f8f9fa; color: #333; line-height: 1.6; }
      
        .container { max-width: 600px; margin: 0 auto; padding: 0 20px; }
      
        header { background: linear-gradient(135deg, #2E86DE, #1a6fc6); color: white; padding: 20px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header-content { display: flex; justify-content: center; align-items: center; }
        .logo { font-size: 1.8rem; font-weight: bold; display: flex; align-items: center; }
        .logo i { margin-right: 10px; font-size: 2rem; }
      
        .hero { background: white; padding: 40px 0; text-align: center; border-radius: 0 0 15px 15px; margin-bottom: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .hero h1 { font-size: 2rem; margin-bottom: 15px; color: #2c3e50; }
        .hero p { font-size: 1.1rem; color: #7f8c8d; max-width: 500px; margin: 0 auto; }
      
        .card { background: white; border-radius: 10px; padding: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin-bottom: 30px; }
        .card h2 { color: #2c3e50; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #f1f2f6; text-align: center; }
      
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #2c3e50; }
        .form-control { width: 100%; padding: 12px 15px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 16px; transition: border-color 0.3s; }
        .form-control:focus { border-color: #2E86DE; outline: none; }
        .form-control:invalid { border-color: #dc3545; }
      
        .btn { background: #2E86DE; color: white; padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; transition: background 0.3s; margin: 5px; }
        .btn:hover { background: #1a6fc6; }
        .btn:disabled { background: #6c757d; cursor: not-allowed; }
        .btn-location { background: #FF9F43; width: 100%; }
        .btn-location:hover { background: #FF8C29; }
        .btn-keldi { background: #10AC84; width: 48%; margin-top: 10px; }
        .btn-keldi:hover { background: #0D8C6B; }
        .btn-ketdi { background: #FF6B6B; width: 48%; margin-top: 10px; }
        .btn-ketdi:hover { background: #FF5252; }
        .btn-view-exit { background: #6C757D; width: 100%; margin-top: 10px; }
        .btn-view-exit:hover { background: #5A6268; }
      
        footer { background: #2c3e50; color: white; padding: 20px 0; margin-top: 30px; text-align: center; }
      
        .success { background: #d4edda; color: #155724; padding: 15px; border-radius: 8px; margin: 15px 0; display: none; border: 1px solid #c3e6cb; }
        .location-status { background: #d1ecf1; color: #0c5460; padding: 12px; border-radius: 8px; margin: 10px 0; display: none; border: 1px solid #bee5eb; }
        .error { background: #f8d7da; color: #721c24; padding: 15px; border-radius: 8px; margin: 15px 0; display: none; border: 1px solid #f5c6cb; }
      
        .status-info {
            background: #e7f3ff;
            color: #0c5460;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #b8daff;
            text-align: center;
            font-size: 0.9rem;
        }
      
        @media (max-width: 768px) {
            .hero h1 { font-size: 1.7rem; }
            .btn-keldi, .btn-ketdi { width: 100%; margin-bottom: 10px; }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <header>
        <div class="container header-content">
            <div class="logo">
                <i class="fas fa-user-clock"></i>
                <span>Keldi-Ketdi Tizimi</span>
            </div>
        </div>
    </header>
    <section class="hero">
        <div class="container">
            <h1>Keldi-Ketdi Nazorat Tizimi</h1>
            <p>–•–æ–¥–∏–º–ª–∞—Ä–Ω–∏–Ω–≥ –∏—à–≥–∞ –∫–µ–ª–∏—à-–∫–µ—Ç–∏–Ω–ª–∞—Ä–∏–Ω–∏ –Ω–∞–∑–æ—Ä–∞—Ç “õ–∏–ª–∏—à —Ç–∏–∑–∏–º–∏</p>
        </div>
    </section>
    <div class="container">
        <div class="card">
            <h2><i class="fas fa-user-check"></i> –•–æ–¥–∏–º –ú–∞—ä–ª—É–º–æ—Ç–ª–∞—Ä–∏</h2>
          
            <div class="status-info">
                <i class="fas fa-info-circle"></i>
                –¢–∏–∑–∏–º Telegram –≥—É—Ä—É“≥–∏–≥–∞ —Ö–∞–±–∞—Ä —é–±–æ—Ä–∞–¥–∏
            </div>
          
            <div class="form-group">
                <label>–•–æ–¥–∏–º –§.–ò.–®. *</label>
                <input type="text" class="form-control" id="employeeName" placeholder="–•–æ–¥–∏–º –§.–ò.–®.–Ω–∏ –∫–∏—Ä–∏—Ç–∏–Ω–≥" required>
            </div>
          
            <div class="form-group">
                <label>–õ–∞–≤–æ–∑–∏–º–∏ *</label>
                <input type="text" class="form-control" id="employeePosition" placeholder="–õ–∞–≤–æ–∑–∏–º–∏–Ω–∏ –∫–∏—Ä–∏—Ç–∏–Ω–≥ (–º–∏—Å–æ–ª: “≤–∞–º—à–∏—Ä–∞, –®–∏—Ñ–æ–∫–æ—Ä)" required>
            </div>
          
            <div class="form-group">
                <label>–ñ–æ–π–ª–∞—à—É–≤ *</label>
                <button type="button" class="btn btn-location" onclick="getLocation()">
                    <i class="fas fa-map-marker-alt"></i> –ñ–æ–π–ª–∞—à—É–≤–Ω–∏ –û–ª–∏—à
                </button>
                <div class="location-status" id="locationStatus">
                    <i class="fas fa-check-circle"></i> –ñ–æ–π–ª–∞—à—É–≤ –º—É–≤–∞—Ñ—Ñ–∞“õ–∏—è—Ç–ª–∏ “õ–∞–±—É–ª “õ–∏–ª–∏–Ω–¥–∏!
                </div>
            </div>
          
            <button class="btn btn-keldi" onclick="saveAttendance('keldi')">
                <i class="fas fa-sign-in-alt"></i> –ö–µ–ª–î–ò
            </button>
            <button class="btn btn-ketdi" onclick="saveAttendance('ketdi')">
                <i class="fas fa-sign-out-alt"></i> –ö–µ—Ç–î–ò
            </button>
            <button class="btn btn-view-exit" onclick="viewLastExit()">
                <i class="fas fa-clock"></i> –û—Ö–∏—Ä–≥–∏ –ö–µ—Ç–∏—à–Ω–∏ –ö—û—Ä–∏—à
            </button>
          
            <div class="success" id="successMessage">
                <i class="fas fa-check-circle"></i> –ú–∞—ä–ª—É–º–æ—Ç–ª–∞—Ä Telegram –≥—É—Ä—É“≥–∏–≥–∞ –º—É–≤–∞—Ñ—Ñ–∞“õ–∏—è—Ç–ª–∏ —é–±–æ—Ä–∏–ª–¥–∏!
            </div>
          
            <div class="error" id="errorMessage">
                <i class="fas fa-exclamation-circle"></i> –ú–∞—ä–ª—É–º–æ—Ç–ª–∞—Ä–Ω–∏ —é–±–æ—Ä–∏—à–¥–∞ —Ö–∞—Ç–æ–ª–∏–∫ —é–∑ –±–µ—Ä–¥–∏!
            </div>
        </div>
    </div>
    <footer>
        <div class="container">
            <p>&copy; 2025 Keldi-Ketdi Tizimi. –ë–∞—Ä—á–∞ “≥—É“õ—É“õ–ª–∞—Ä “≥–∏–º–æ—è–ª–∞–Ω–≥–∞–Ω.</p>
        </div>
    </footer>
    <script>
        let userLocation = null;
       
        // Telegram –±–æ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Å–∏
        const BOT_TOKEN = '8524124275:AAGs_yIOlD2INhLw0SitQGwFvnISZXjbeBM';
        const CHAT_ID = '-1003066440730';
      
        // localStorage –¥–∞–Ω –º–∞—ä–ª—É–º–æ—Ç–ª–∞—Ä–Ω–∏ —é–∫–ª–∞—à
        window.onload = function() {
            const savedName = localStorage.getItem('employeeName');
            const savedPosition = localStorage.getItem('employeePosition');
            if (savedName) document.getElementById('employeeName').value = savedName;
            if (savedPosition) document.getElementById('employeePosition').value = savedPosition;
        };
      
        function getLocation() {
            if (!navigator.geolocation) {
                alert("‚ùå –ë—Ä–∞—É–∑–µ—Ä–∏–Ω–≥–∏–∑ –∂–æ–π–ª–∞—à—É–≤–Ω–∏ “õ—û–ª–ª–∞–±-“õ—É–≤–≤–∞—Ç–ª–∞–º–∞–π–¥–∏");
                return;
            }
            const locationBtn = document.querySelector('.btn-location');
            const originalText = locationBtn.innerHTML;
            locationBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –ñ–æ–π–ª–∞—à—É–≤ –æ–ª–∏–Ω–º–æ“õ–¥–∞...';
            locationBtn.disabled = true;
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    userLocation = {
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude,
                        accuracy: position.coords.accuracy
                    };
                    document.getElementById('locationStatus').style.display = 'block';
                    locationBtn.innerHTML = '<i class="fas fa-check-circle"></i> –ñ–æ–π–ª–∞—à—É–≤ –û–ª–∏–Ω–¥–∏';
                    locationBtn.style.background = '#10AC84';
                    console.log('–ñ–æ–π–ª–∞—à—É–≤ –æ–ª–∏–Ω–¥–∏:', userLocation);
                },
                function(error) {
                    let errorMessage = "‚ùå –ñ–æ–π–ª–∞—à—É–≤–Ω–∏ –æ–ª–∏—à–¥–∞ —Ö–∞—Ç–æ–ª–∏–∫: ";
                    switch(error.code) {
                        case error.PERMISSION_DENIED: errorMessage += "–†—É—Ö—Å–∞—Ç –±–µ—Ä–º–∞–¥–∏"; break;
                        case error.POSITION_UNAVAILABLE: errorMessage += "–ú–∞—ä–ª—É–º–æ—Ç–ª–∞—Ä –π—û“õ"; break;
                        case error.TIMEOUT: errorMessage += "–í–∞“õ—Ç —Ç—É–≥–∞–¥–∏"; break;
                        default: errorMessage += "–ù–æ–º–∞—ä–ª—É–º"; break;
                    }
                    alert(errorMessage);
                    locationBtn.innerHTML = originalText;
                    locationBtn.disabled = false;
                    locationBtn.style.background = '#FF9F43';
                },
                { enableHighAccuracy: true, timeout: 15000, maximumAge: 60000 }
            );
        }
        async function sendTelegramMessage(message) {
            const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    chat_id: CHAT_ID,
                    text: message,
                    parse_mode: 'HTML'
                })
            });
            if (!response.ok) throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            const data = await response.json();
            if (!data.ok) throw new Error(data.description || '–ù–æ–º–∞—ä–ª—É–º —Ö–∞—Ç–æ–ª–∏–∫');
        }
        function saveAttendance(type) { // 'keldi' yoki 'ketdi'
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
            const employeeName = document.getElementById('employeeName').value.trim();
            const employeePosition = document.getElementById('employeePosition').value.trim();
          
            if(!employeeName || !employeePosition) {
                alert('‚ùå –ò–ª—Ç–∏–º–æ—Å, –±–∞—Ä—á–∞ –º–∞–π–¥–æ–Ω–ª–∞—Ä–Ω–∏ —Ç—û–ª–¥–∏—Ä–∏–Ω–≥!');
                return;
            }
            if (!userLocation) {
                alert('‚ùå –ò–ª—Ç–∏–º–æ—Å, –∞–≤–≤–∞–ª –∂–æ–π–ª–∞—à—É–≤–Ω–∏ –æ–ª–∏–Ω–≥!');
                return;
            }
            // localStorage –≥–∞ —Å–∞“õ–ª–∞—à
            localStorage.setItem('employeeName', employeeName);
            localStorage.setItem('employeePosition', employeePosition);
          
            const submitBtn = document.querySelector(type === 'keldi' ? '.btn-keldi' : '.btn-ketdi');
            const originalBtnText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –Æ–±–æ—Ä–∏–ª–º–æ“õ–¥–∞...';
            submitBtn.disabled = true;
          
            const locationLink = `https://www.google.com/maps?q=${userLocation.latitude},${userLocation.longitude}`;
            const locationText = `üìç –ñ–æ–π–ª–∞—à—É–≤: ${userLocation.latitude.toFixed(6)}, ${userLocation.longitude.toFixed(6)}`;
          
            const now = new Date();
            const dateStr = now.toLocaleDateString('uz-UZ', { year: 'numeric', month: 'long', day: 'numeric' });
            const timeStr = now.toLocaleTimeString('uz-UZ');
            const actionEmoji = type === 'keldi' ? 'üü¢ –ö–ï–õ–î–ò' : 'üî¥ –ö–ï–¢–î–ò';
          
            const message = `üë§ <b>–Ø–ù–ì–ò –•–û–î–ò–ú –ú–ê–™–õ–£–ú–û–¢–õ–ê–†–ò</b>
${actionEmoji}
üìã <b>–•–æ–¥–∏–º –§.–ò.–®.:</b> ${employeeName}
üíº <b>–õ–∞–≤–æ–∑–∏–º–∏:</b> ${employeePosition}
üó∫Ô∏è ${locationText}
üîó <b>–•–∞—Ä–∏—Ç–∞:</b> ${locationLink}
üìÖ <b>–°–∞–Ω–∞:</b> ${dateStr}
‚è∞ <b>–í–∞“õ—Ç:</b> ${timeStr}
#keldi_ketdi #${employeePosition.replace(/\s+/g, '_')} #${type}`;
          
            sendTelegramMessage(message)
            .then(() => {
                showSuccessMessage();
                // Ketdi “≥–æ–ª–∞—Ç–∏–¥–∞ —Å–∞–Ω–∞ –≤–∞ –≤–∞“õ—Ç–Ω–∏ —Å–∞“õ–ª–∞—à
                if (type === 'ketdi') {
                    localStorage.setItem('lastExit', JSON.stringify({ date: dateStr, time: timeStr, name: employeeName }));
                }
                userLocation = null;
                document.getElementById('locationStatus').style.display = 'none';
                const locationBtn = document.querySelector('.btn-location');
                locationBtn.innerHTML = '<i class="fas fa-map-marker-alt"></i> –ñ–æ–π–ª–∞—à—É–≤–Ω–∏ –û–ª–∏—à';
                locationBtn.style.background = '#FF9F43';
                locationBtn.disabled = false;
            })
            .catch(error => {
                console.error('–•–∞—Ç–æ–ª–∏–∫:', error);
                document.getElementById('errorMessage').style.display = 'block';
                alert('‚ùå –•–∞—Ç–æ–ª–∏–∫: ' + error.message);
            })
            .finally(() => {
                submitBtn.innerHTML = originalBtnText;
                submitBtn.disabled = false;
            });
        }
        function viewLastExit() {
            const lastExit = localStorage.getItem('lastExit');
            if (!lastExit) {
                alert('‚ùå –û—Ö–∏—Ä–≥–∏ –∫–µ—Ç–∏—à –º–∞—ä–ª—É–º–æ—Ç–∏ –π—û“õ. –ê–≤–≤–∞–ª "–ö–µ—Ç–¥–∏" —Ç—É–≥–º–∞—Å–∏–Ω–∏ –±–æ—Å–∏–Ω–≥!');
                return;
            }
            const data = JSON.parse(lastExit);
            alert(`üî¥ –û—Ö–∏—Ä–≥–∏ –∫–µ—Ç–∏—à:\n–•–æ–¥–∏–º: ${data.name}\n–°–∞–Ω–∞: ${data.date}\n–í–∞“õ—Ç: ${data.time}`);
        }
        function showSuccessMessage() {
            document.getElementById('successMessage').style.display = 'block';
            setTimeout(() => document.getElementById('successMessage').style.display = 'none', 5000);
        }
        console.log('Keldi-Ketdi Tizimi —é–∫–ª–∞–Ω–¥–∏ (Keldi-Ketdi versiyasi)');
        console.log('Telegram –±–æ—Ç: ' + BOT_TOKEN);
        console.log('–ì—É—Ä—É“≥ ID: ' + CHAT_ID);
    </script>
</body>
</html>
